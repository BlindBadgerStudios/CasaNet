---
- name: SSHD - Copy Key for user and disable password login
  hosts: all
  become: yes  # To elevate privileges to perform administrative tasks

  tasks:
    - name: Copy SSH Key to user's authorized_keys file
      authorized_key:
        user: "{{ username }}"
        key: "{{ lookup('file', '/home/{{ username }}/.ssh/id_rsa.pub') }}" 
        state: present
        exclusive: true

    #- name: Configure SSHD to restrict password logins to a single host
    #  lineinfile:
    #    path: /etc/ssh/sshd_config
    #    regexp: '^(PasswordAuthentication\s+)yes$'
    #    line: 'PasswordAuthentication no'
    #  notify: Restart SSHD

  #handlers:
  #  - name: Restart SSHD
  #    service:
  #      name: sshd
  #      state: restarted
